# 竖屏识别

> 创建时间: 2023-06-18  
> 更新时间: 2023-06-18

## 问题

如果竖屏视频在当前横屏的屏幕上播放，视频的左右两边均呈现为黑色。为了让两边都有内容展示，一般会将竖屏视频(尤其是舞蹈视频)复制成多份从左往右排列在屏幕上，从而实现将整个横屏屏幕填充。

![hv-screen](https://storage-1301473886.cos.ap-guangzhou.myqcloud.com/img/vertical-detect/hv-screen.png)

然而，对于整个视频而言，里面不一定都是以上述方式填充，可能会存在部分长度的视频是完全的横屏视频，因此，本文提供一种方法用于在视频中识别出由竖屏视频填充的长度间隔。

## 实现思想

视频的处理本质上是对特定帧图像的处理，因此流程中会省略帧提取的操作，着重对图像的处理。

### 方法一(可能行)

由于两个竖屏之间的边缘位置图像不是连续的，那么这部分就可能会出现边缘。借助这个特性，通过检测图像中的**垂直直线**并通过一定长度筛选到无关部分的直线，剩下的直线大致能够将图像分成三个部分，通过检测这三个部分的宽度是否大致相等，如果是则为竖屏合并的视频，否则不是。

该方法有着较大的不确定性：
- 直线长度的确定：直线长度的筛选可能就需要通过大量的测试调参才能得出一个较好的值。
- 竖屏图像背景干扰：如果竖屏图像的背景有着较多的直线，就会对该方法有着极大的干扰。

### 方法二(适用于合并的竖屏视频是完全相等的)

由于这几个竖屏图像是完全相同的，那么这些竖屏图像的水平长度是一致的，借助该特性，实现步骤为：
1. 通过将当前图像的水平长度进行均分后就能得到一个近似的竖屏图像水平长度。
2. 根据该长度将当前图像裁切成多个等长等宽的子图像，并对这些子图像相互之间求取图像近似值。
3. 如果这些近似值都大于某个值，那么就代表这些子图像是近似相等的，这意味着当前图像即使由多个相同的竖屏图像组成。

## 具体实现

实现环境:
- 语言: python3.8
- 库: opencv

以下代码是假定视频是由三个竖屏视频合并而成的

```python
def isVertical(img):
    height = img.shape[0]
    width = img.shape[1]
    subWidth = width // 3
    # 裁切
    img1 = img[0: height, 0: subWidth]
    img2 = img[0: height, subWidth: 2* subWidth]
    img3 = img[0: height, 2 * subWidth:]
    # 计算模板匹配得分
    result1 = cv.matchTemplate(img1, img2, cv.TM_CCOEFF_NORMED)
    # 获取最大得分和相应的位置
    min_val1 = cv.minMaxLoc(result1)[0]
    # 计算模板匹配得分
    result2 = cv.matchTemplate(img2, img3, cv.TM_CCOEFF_NORMED)
    # 获取最大得分和相应的位置
    min_val2 = cv.minMaxLoc(result2)[0]
    # 阈值可以通过少量测试得出
    return min_val2 >= 0.65
```